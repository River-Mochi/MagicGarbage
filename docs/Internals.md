## Internal systems & behaviour

| Area / Feature                     | What it does                                                                                     | Implementation (high level)                                                                             |
|------------------------------------|--------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| Total Magic toggle                 | When ON, keeps the entire city garbage-free. Mutually exclusive with Semi-Magic.                | `Setting.TotalMagic` / `Setting.SemiMagicEnabled` setters ensure they can’t both be ON at once; defaults start with Total Magic ON, Semi-Magic OFF. |
| Total Magic – cleanup pass         | Wipes garbage counters, requests, and warning flags on all garbage producers while enabled.     | `MagicGarbageSystem` Burst `MagicJob` iterates `GarbageProducer` chunks and clears state each run **only when** `setting.TotalMagic` is true. |
| Total Magic – update behaviour     | System is scheduled every simulation tick but is effectively free when Total Magic is OFF.      | `MagicGarbageSystem.OnUpdate()` immediately returns if `Mod.Setting` is `null` or `setting.TotalMagic` is `false`, so no job is scheduled. |
| Total Magic – requests & flags     | Cancels collection requests and clears “garbage piling up” flags to prevent new issues.          | Job resets `m_Garbage`, `m_CollectionRequest`, `m_DispatchIndex`, and clears `GarbageProducerFlags.GarbagePilingUpWarning`. |
| Total Magic – world icons          | Removes garbage warning icons above buildings so the UI reflects the cleaned state.              | `IconCommandBuffer.Remove(building, m_GarbageParameters.m_GarbageNotificationPrefab)` for each processed building. |
| Semi-Magic master toggle           | Enables “enhanced vanilla” mode using stronger trucks/facilities instead of full magic.          | `Setting.SemiMagicEnabled` is exclusive with `TotalMagic`; turning one ON forces the other OFF.        |
| Semi-Magic truck load slider       | Scales garbage truck **capacity** (100–500% of vanilla) and matching unload rate.                | `GarbageTruckCapacitySystem` uses `SystemAPI.Query<RefRW<GarbageTruckData>>()` to scale capacity + unload rate. |
| Semi-Magic facility tuning         | Scales facility **truck count**, **processing speed**, and **storage capacity** from sliders.    | `GarbageFacilityCapacitySystem` scales `m_VehicleCapacity`, `m_ProcessingSpeed`, and `m_GarbageCapacity`. |
| Semi-Magic update timing           | Only recalculates truck and facility stats when slider/toggle values actually change.            | Both Semi-Magic systems are enabled by `Setting.Apply()`, run one pass, update cached multipliers, then set `Enabled = false`. |
| Semi-Magic presets                 | “Game Defaults” restores pure vanilla; “Recommended” applies tuned values (200/150/200/150).     | `Setting.SemiMagicDefaults` and `Setting.SemiMagicRecommended` set slider fields and call `Apply()`.   |
| Vanilla compatibility              | Player can always return to exact vanilla behaviour.                                             | Total Magic OFF + Semi-Magic ON + “Game Defaults” → all multipliers = 100%, Semi-Magic systems early-out. |
| Options UI – Actions tab           | Shows **Total Magic** toggle, **Semi-Magic** toggle, all Semi-Magic sliders, and preset buttons. | Defined in `Setting` via `[SettingsUISection]`, `[SettingsUISlider]`, `[SettingsUIButtonGroup]`, etc.  |
| Options UI – slider visibility     | Hides all Semi-Magic sliders/buttons when Semi-Magic is disabled.                                | `[SettingsUIHideByCondition(typeof(Setting), nameof(Setting.SemiMagicEnabled), true)]` on sliders/buttons. |
| Options UI – About tab             | Displays mod name + tag, version, Paradox Mods + Discord buttons, and usage notes.              | `Setting.AboutName` / `AboutVersion` plus locale entries; usage block via `[SettingsUIMultilineText]`. |
| Options UI – default values        | First launch: Total Magic ON, Semi-Magic OFF, all sliders at 100%.                              | `Setting.SetDefaults()` initializes backing fields and multipliers.                                    |
| Mod bootstrap                      | Registers settings, locales, and hooks main systems into the GameSimulation phase.               | `Mod.OnLoad` calls `RegisterInOptionsUI()`, adds locales, and schedules `MagicGarbageSystem`, `GarbageTruckCapacitySystem`, and `GarbageFacilityCapacitySystem`. |
| Settings persistence               | Player choices persist across sessions.                                                          | `AssetDatabase.global.LoadSettings("MagicGarbage", setting, new Setting(this));`.                      |
| Localization                       | Uses English + translated locale sources; display name uses single source of truth.              | `LocaleEN` (and `LocaleXX`) implement `IDictionarySource` and build text from `Mod.ModName` / `Mod.ModTag`. |
| Logging                            | Minimal in release; debug builds show load banner and unload.                                   | `Mod.Log` logger configured with `SetShowsErrorsInUI` and `#if DEBUG` info messages.                    |
